class Color{constructor($,t,s){this.set($,t,s)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set($,t,s){this.r=this.clamp($),this.g=this.clamp(t),this.b=this.clamp(s)}hueRotate($=0){$=$/180*Math.PI;let t=Math.sin($),s=Math.cos($);this.multiply([.213+.787*s-.213*t,.715-.715*s-.715*t,.072-.072*s+.928*t,.213-.213*s+.143*t,.715+.285*s+.14*t,.072-.072*s-.283*t,.213-.213*s-.787*t,.715-.715*s+.715*t,.072+.928*s+.072*t,])}grayscale($=1){this.multiply([.2126+.7874*(1-$),.7152-.7152*(1-$),.0722-.0722*(1-$),.2126-.2126*(1-$),.7152+.2848*(1-$),.0722-.0722*(1-$),.2126-.2126*(1-$),.7152-.7152*(1-$),.0722+.9278*(1-$),])}sepia($=1){this.multiply([.393+.607*(1-$),.769-.769*(1-$),.189-.189*(1-$),.349-.349*(1-$),.686+.314*(1-$),.168-.168*(1-$),.272-.272*(1-$),.534-.534*(1-$),.131+.869*(1-$),])}saturate($=1){this.multiply([.213+.787*$,.715-.715*$,.072-.072*$,.213-.213*$,.715+.285*$,.072-.072*$,.213-.213*$,.715-.715*$,.072+.928*$,])}multiply($){let t=this.clamp(this.r*$[0]+this.g*$[1]+this.b*$[2]),s=this.clamp(this.r*$[3]+this.g*$[4]+this.b*$[5]),e=this.clamp(this.r*$[6]+this.g*$[7]+this.b*$[8]);this.r=t,this.g=s,this.b=e}brightness($=1){this.linear($)}contrast($=1){this.linear($,-(.5*$)+.5)}linear($=1,t=0){this.r=this.clamp(this.r*$+255*t),this.g=this.clamp(this.g*$+255*t),this.b=this.clamp(this.b*$+255*t)}invert($=1){this.r=this.clamp(($+this.r/255*(1-2*$))*255),this.g=this.clamp(($+this.g/255*(1-2*$))*255),this.b=this.clamp(($+this.b/255*(1-2*$))*255)}hsl(){let $=this.r/255,t=this.g/255,s=this.b/255,e=Math.max($,t,s),_=Math.min($,t,s),i,l,r=(e+_)/2;if(e===_)i=l=0;else{let h=e-_;switch(l=r>.5?h/(2-e-_):h/(e+_),e){case $:i=(t-s)/h+(t<s?6:0);break;case t:i=(s-$)/h+2;break;case s:i=($-t)/h+4}i/=6}return{h:100*i,s:100*l,l:100*r}}clamp($){return $>255?$=255:$<0&&($=0),$}}class Solver{constructor($,t){this.target=$,this.targetHSL=$.hsl(),this.reusedColor=new Color(0,0,0)}solve(){let $=this.solveNarrow(this.solveWide());return{values:$.values,loss:$.loss,filter:this.css($.values)}}solveWide(){let $=[60,180,18e3,600,1.2,1.2],t={loss:1/0};for(let s=0;t.loss>25&&s<3;s++){let e=[50,20,3750,50,100,100],_=this.spsa(5,$,15,e,1e3);_.loss<t.loss&&(t=_)}return t}solveNarrow($){let t=$.loss,s=t+1;return this.spsa(t,[.25*s,.25*s,s,.25*s,.2*s,.2*s],2,$.values,500)}spsa($,t,s,e,_){let i=null,l=1/0,r=Array(6),h=Array(6),a=Array(6);for(let o=0;o<_;o++){let n=s/Math.pow(o+1,.16666666666666666);for(let u=0;u<6;u++)r[u]=Math.random()>.5?1:-1,h[u]=e[u]+n*r[u],a[u]=e[u]-n*r[u];let c=this.loss(h)-this.loss(a);for(let g=0;g<6;g++){let b=c/(2*n)*r[g],p=t[g]/Math.pow($+o+1,1);e[g]=d(e[g]-p*b,g)}let m=this.loss(e);m<l&&(i=e.slice(0),l=m)}return{values:i,loss:l};function d($,t){let s=100;return 2===t?s=7500:(4===t||5===t)&&(s=200),3===t?$>s?$%=s:$<0&&($=s+$%s):$<0?$=0:$>s&&($=s),$}}loss($){let t=this.reusedColor;t.set(0,0,0),t.invert($[0]/100),t.sepia($[1]/100),t.saturate($[2]/100),t.hueRotate(3.6*$[3]),t.brightness($[4]/100),t.contrast($[5]/100);let s=t.hsl();return Math.abs(t.r-this.target.r)+Math.abs(t.g-this.target.g)+Math.abs(t.b-this.target.b)+Math.abs(s.h-this.targetHSL.h)+Math.abs(s.s-this.targetHSL.s)+Math.abs(s.l-this.targetHSL.l)}css($){function t(t,s=1){return Math.round($[t]*s)}return`filter: invert(${t(0)}%) sepia(${t(1)}%) saturate(${t(2)}%) hue-rotate(${t(3,3.6)}deg) brightness(${t(4)}%) contrast(${t(5)}%);`}}const hexToRgb=$=>{let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;$=$.replace(t,($,t,s,e)=>t+t+s+s+e+e);let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec($);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),]:null},hexCodeToFilter=$=>{let t=hexToRgb($);if(3!==t.length)return"";let s=new Color(t[0],t[1],t[2]),e=new Solver(s),_=e.solve();return _.filter};
